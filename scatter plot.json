{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 760,
  "height": 420,
  "title": {
    "text": "Rainfall vs Cereal Yield (2022)",
    "font": "Garamond",
    "fontSize": 18,
    "fontWeight": "bold",
    "anchor": "start",
    "color": "black"
  },
  "data": {
    "url": "https://raw.githubusercontent.com/ywuu0346-bot/3179/refs/heads/main/clean%20data.csv"
  },

  "params": [
    {
      "name": "precipMin",
      "value": 0,
      "bind": {
        "input": "range",
        "min": 0,
        "max": 3000,
        "step": 100,
        "name": "Min rainfall (mm) â‰¥ "
      }
    },
    {
      "name": "countrySel",
      "value": "All",
      "bind": {
        "input": "select",
        "options": [
          "All",
          "Australia",
          "United States",
          "China",
          "India",
          "Brazil",
          "Indonesia",
          "Japan",
          "Germany",
          "France",
          "United Kingdom",
          "Canada"
        ]
      }
    }
  ],

  "transform": [
    {
      "filter": "!isNaN(datum.precip_mm) && !isNaN(datum.cereal_yield_kgph)"
    },
    {
      "filter": "datum.precip_mm >= precipMin"
    },
    {
      "calculate": "datum['Country Name']",
      "as": "country"
    },
    {
      "filter": "countrySel == 'All' || datum.country == countrySel"
    }
  ],

  "layer": [
    {
      "mark": {
        "type": "point",
        "filled": true,
        "size": 70,
        "opacity": 0.85,
        "stroke": "#2c3e50",
        "strokeWidth": 0.2,
        "color": "#4CAF50"
      },
      "encoding": {
        "x": {
          "field": "precip_mm",
          "type": "quantitative",
          "title": "Mean annual rainfall (mm)",
          "axis": { "format": ",.0f" }
        },
        "y": {
          "field": "cereal_yield_kgph",
          "type": "quantitative",
          "title": "Cereal yield (kg/ha)",
          "axis": { "format": ",.0f" }
        },
        "tooltip": [
          { "field": "country", "title": "Country" },
          { "field": "precip_mm", "title": "Rainfall (mm)", "format": ",.0f" },
          { "field": "cereal_yield_kgph", "title": "Cereal yield (kg/ha)", "format": ",.0f" }
        ]
      }
    },

    {
      "transform": [
        {
          "aggregate": [
            { "op": "mean", "field": "precip_mm", "as": "xmean" }
          ]
        }
      ],
      "mark": {
        "type": "rule",
        "strokeDash": [4, 4],
        "color": "#9e9e9e"
      },
      "encoding": {
        "x": { "field": "xmean", "type": "quantitative" }
      }
    },
    {
      "transform": [
        {
          "aggregate": [
            { "op": "mean", "field": "cereal_yield_kgph", "as": "ymean" }
          ]
        }
      ],
      "mark": {
        "type": "rule",
        "strokeDash": [4, 4],
        "color": "#9e9e9e"
      },
      "encoding": {
        "y": { "field": "ymean", "type": "quantitative" }
      }
    },

    {
      "transform": [
        {
          "filter": "datum['Country Name'] == 'Australia'"
        }
      ],
      "mark": {
        "type": "text",
        "dx": 6,
        "dy": -6,
        "fontSize": 12,
        "fontWeight": "bold",
        "font": "Garamond",
        "fill": "#37474f"
      },
      "encoding": {
        "x": { "field": "precip_mm", "type": "quantitative" },
        "y": { "field": "cereal_yield_kgph", "type": "quantitative" },
        "text": { "value": "Australia" }
      }
    }
  ],

  "config": {
    "font": "Garamond",
    "axis": {
      "labelFont": "Garamond",
      "labelFontSize": 13,
      "labelColor": "#333",
      "titleFont": "Garamond",
      "titleFontSize": 14,
      "titleFontWeight": "bold",
      "titleColor": "#222"
    },
    "legend": {
      "labelFont": "Garamond",
      "labelFontSize": 13,
      "labelColor": "#333",
      "titleFont": "Garamond",
      "titleFontSize": 14,
      "titleFontWeight": "bold",
      "titleColor": "#222"
    }
  }
}