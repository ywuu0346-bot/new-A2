{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 760,
  "height": 420,
  "title": {
    "text": "Rainfall vs Cereal Yield (2022)",
    "font": "Garamond",
    "fontSize": 18,
    "fontWeight": "bold",
    "anchor": "middle",
    "color": "black"
  },
  "data": {
    "url": "https://raw.githubusercontent.com/ywuu0346-bot/3179/refs/heads/main/clean%20data.csv"
  },
  "params": [
    {
      "name": "precipMin",
      "value": 0,
      "bind": {
        "input": "range",
        "min": 0,
        "max": 3000,
        "step": 100,
        "name": "Min rainfall (mm) â‰¥ "
      }
    },
    {
      "name": "countrySel",
      "value": "All",
      "bind": {
        "input": "select",
        "options": [
          "All",
          "Australia",
          "United States",
          "China",
          "India",
          "Brazil",
          "Germany",
          "France",
          "United Kingdom",
          "Canada"
        ],
        "name": "countrySel "
      }
    }
  ],
  "transform": [
    { "filter": "!isNaN(datum.precip_mm) && !isNaN(datum.cereal_yield_kgph)" },
    { "filter": "datum.precip_mm >= precipMin" },
    { "calculate": "datum['Country Name']", "as": "country" },
    { "filter": "countrySel == 'All' || datum.country == countrySel" },
    {
      "calculate": "indexof(['Australia','United States','China','India','Brazil','Germany','France','United Kingdom','Canada'], datum.country) >= 0 ? 'highlight' : 'other'",
      "as": "group"
    }
  ],
  "layer": [
    {
      "transform": [ { "filter": "datum.group == 'other'" } ],
      "mark": {
        "type": "point",
        "filled": true,
        "size": 70,
        "opacity": 0.65,
        "stroke": "white",
        "strokeWidth": 0.6,
        "color": "#a3a7ac"
      },
      "encoding": {
        "x": {
          "field": "precip_mm",
          "type": "quantitative",
          "title": "Mean annual rainfall (mm)",
          "axis": { "format": ",.0f" }
        },
        "y": {
          "field": "cereal_yield_kgph",
          "type": "quantitative",
          "title": "Cereal yield (kg/ha)",
          "axis": { "format": ",.0f" }
        },
        "tooltip": [
          { "field": "country", "title": "Country" },
          { "field": "precip_mm", "title": "Rainfall (mm)", "format": ",.0f" },
          { "field": "cereal_yield_kgph", "title": "Cereal yield (kg/ha)", "format": ",.0f" }
        ]
      }
    },
    {
      "transform": [ { "filter": "datum.group == 'highlight'" } ],
      "mark": {
        "type": "point",
        "filled": true,
        "size": 90,
        "opacity": 1,
        "stroke": "#1f2937",
        "strokeWidth": 0.6
      },
      "encoding": {
        "x": { "field": "precip_mm", "type": "quantitative" },
        "y": { "field": "cereal_yield_kgph", "type": "quantitative" },
        "color": {
          "field": "country",
          "type": "nominal",
          "title": "Highlighted countries",
          "scale": {
            "domain": [
              "Australia",
              "United States",
              "China",
              "India",
              "Brazil",
              "Germany",
              "France",
              "United Kingdom",
              "Canada"
            ],
            "range": [
              "#1bbd2e",
              "#3b82f6",
              "#ef4444",
              "#f59e0b",
              "#10b981",
              "#111827",
              "#e11d48",
              "#0ea5e9",
              "#22d3ee"
            ]
          },
          "legend": { "orient": "right", "columns": 1 }
        },
        "tooltip": [
          { "field": "country", "title": "Country" },
          { "field": "precip_mm", "title": "Rainfall (mm)", "format": ",.0f" },
          { "field": "cereal_yield_kgph", "title": "Cereal yield (kg/ha)", "format": ",.0f" }
        ]
      }
    },
    {
      "transform": [ { "aggregate": [ { "op": "mean", "field": "precip_mm", "as": "xmean" } ] } ],
      "mark": { "type": "rule", "strokeDash": [4, 4], "color": "#797878" },
      "encoding": { "x": { "field": "xmean", "type": "quantitative" } }
    },
    {
      "transform": [ { "aggregate": [ { "op": "mean", "field": "cereal_yield_kgph", "as": "ymean" } ] } ],
      "mark": { "type": "rule", "strokeDash": [4, 4], "color": "#818181" },
      "encoding": { "y": { "field": "ymean", "type": "quantitative" } }
    },
    {
      "transform": [ { "filter": "datum.country == 'Australia'" } ],
      "mark": {
        "type": "text",
        "dx": 8,
        "dy": -8,
        "fontSize": 12,
        "fontWeight": "bold",
        "font": "Garamond",
        "fill": "#1e88e5"
      },
      "encoding": {
        "x": { "field": "precip_mm", "type": "quantitative" },
        "y": { "field": "cereal_yield_kgph", "type": "quantitative" },
        "text": { "value": "Australia" }
      }
    }
  ],
  "config": {
    "font": "Garamond",
    "axis": {
      "labelFont": "Garamond",
      "labelFontSize": 13,
      "labelColor": "#333",
      "titleFont": "Garamond",
      "titleFontSize": 14,
      "titleFontWeight": "bold",
      "titleColor": "#222"
    },
    "legend": {
      "labelFont": "Garamond",
      "labelFontSize": 13,
      "labelColor": "#333",
      "titleFont": "Garamond",
      "titleFontSize": 14,
      "titleFontWeight": "bold",
      "titleColor": "#222"
    }
  }
}